<!doctype html>
<html>
<head>
<title>Inspector</title>
</head>
<style>
*{font-family:verdana,arial,helvetica,sans-serif}
th{font-size:67%;font-weight:normal;text-align:left;vertical-align:bottom}
</style>
<body>
<table>
<tr><th>REMOTE NAME<td>&nbsp;<td id="rname" onclick="go()">(Click to scan)
<tr><th>&nbsp;
<tr><th>CMD_POWER<td><td id="cpwer">
<tr><th>CMD_TEMPERATURE<td><td id="ctemp">
<tr><th>CMD_TIMER<td><td id="ctimr">
<tr><th>CMD_PERIPHERAL<td><td id="cprph">
<tr><th>CMD_LOADTEST<td><td id="ctest">
<tr><th>CMD_INDICATOR<td><td id="cindi">
<tr><th>CMD_MODE<td><td id="cmode">
<tr><th>&nbsp;
<tr><th>RSP_ERROR<td><td>
<tr><th>RSP_TEMPERATURE<td><td>
<tr><th>RSP_BUTTON<td><td>
<tr><th>RSP_KNOB<td><td>
<tr><th>&nbsp;
<tr><th>RSP_CURRENT<td><td>
<tr><th>RSP_VOLTAGE<td><td>
<tr><th>RSP_PULSE<td><td>
<tr><th>RSP_LOADTEST<td><td>
<tr><th>&nbsp;
<tr><th>RSP_TEMPCOIL<td><td>
<tr><th>RSP_TEMPENV<td><td>
<tr><th>RSP_TEMPSINK<td><td>
<tr><th>&nbsp;
<tr><th>RSP_CLOCK<td><td>
<tr><th>RSP_TOPOLOGY<td><td>
<tr><th>RSP_VERSION<td><td>
</table>
<p>Links
<ul>
<li><a href="https://googlechrome.github.io/samples/web-bluetooth/">Web Bluetooth Samples</a>
<li><a href="https://github.com/WebBluetoothCG">Web Bluetooth Community Group</a>
</ul>
</body>
<script>
cindi = document.getElementById('cindi');
cmode = document.getElementById('cmode');
cprph = document.getElementById('cprph');
cpwer = document.getElementById('cpwer');
ctemp = document.getElementById('ctemp');
ctest = document.getElementById('ctest');
ctimr = document.getElementById('ctimr');
rname = document.getElementById('rname');

uuid_tnnl = '00000000-0000-1000-8000-00805f9b34fb';
uuid_down = '00000002-0000-1000-8000-00805f9b34fb'

function go(){
    navigator.bluetooth.requestDevice({filters:[{services: [uuid_tnnl]}]})
    .then(device => {
        rname.innerHTML = device.name;
        console.log('device.gatt.connect');
        return device.gatt.connect();
    })
    .then(server => {
        console.log('server.getPrimaryService');
        return server.getPrimaryService(uuid_tnnl);
    })
    .then(service => service.getCharacteristic(uuid_down))
    .then(characteristic => characteristic.startNotifications())
    .then(characteristic => {
        characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicValueChanged);
        console.log('Notifications have been started.');
    })
    .catch(error => { console.log(error); });
}

function handleCharacteristicValueChanged(event) {
    var s = event.target.value;
    var i, n = s.byteLength;
    for (i = 0; i < n;){
        var k = s.getInt8(i++);
        var v = s.getInt8(i++);
        switch(k){
        case 0x22:
            cpwer.innerHTML = v;
            break;
        case 0x24:
            cprph.innerHTML = v;
            break;
        case 0x26:
            ctest.innerHTML = v;
            break;
        case 0x28:
            ctimr.innerHTML = v;
            break;
        case 0x2a:
            ctemp.innerHTML = v;
            break;
        case 0x2c:
            cindi.innerHTML = v;
            break;
        case 0x2d:
            cmode.innerHTML = v;
            break;
        default:
            console.log('k: ' + k + ', v: ' + v);
        }
    }
}
</script>
</html>